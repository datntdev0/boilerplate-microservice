# Database Migration Guideline

This document provides guidelines for performing database migrations in our project. It covers best practices, tools, and steps to ensure smooth transitions between database schema versions.

Prerequisites: You should have the EF Core CLI tools installed. If you haven't installed them yet, you can do so by running the following command:

```
dotnet tool install --global dotnet-ef --version 9.0.12
```

## When you need to update the database schema, follow these steps:

2. Create a new migration using the Entity Framework Core CLI on the `Migrator` project directory:
   ```bash
   dotnet ef migrations add <MigrationName> --output-dir Migrations/<MicroserviceName> --context <DbContextName>
   
   dotnet ef migrations add <MigrationName> --output-dir Migrations/App/Identity --context MicroserviceAppIdentityDbContext
   dotnet ef migrations add <MigrationName> --output-dir Migrations/Srv/Identity --context MicroserviceSrvIdentityDbContext
   dotnet ef migrations add <MigrationName> --output-dir Migrations/Srv/Payment --context MicroserviceSrvPaymentDbContext
   
   ```
3. Apply the migration to the database by running the `Migrator` project, which includes schema migrations and data seeding.

## Squash migrations into a single migration

### Srv.Identity microservice
 
1. Remove all existing migrations of a service from the `Migrations` folder in the `Migrator` project directory.
   ```bash
   rm -rf ./Migrations/<MicroserviceName>
   ```
2. Drop the existing database to ensure a clean state:
   ```bash
   dotnet ef database drop --context <DbContextName> --force
   ```
3. Create a new migration that captures the current state of the database schema:
   ```bash
   dotnet ef migrations add <MigrationName> --output-dir Migrations/<MicroserviceName> --context <DbContextName>
   ```

### 
